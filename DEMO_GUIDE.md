# デモ実行ガイド

## 事前準備

### 1. サーバーの起動確認

```bash
# Dockerコンテナの確認
docker compose ps

# Next.jsサーバーの確認（ターミナル1）
# http://localhost:3000 で起動しているはず

# WebSocketサーバーの確認（ターミナル2）
# ws://localhost:3001 で起動しているはず
```

### 2. データベースの確認

```bash
# テストデータが投入されているか確認
psql postgresql://postgres:password@localhost:5432/hospital_chat -c "SELECT COUNT(*) FROM \"User\";"
```

## デモシナリオ

### シナリオ 1: 基本的なメッセージ送受信

#### PC1（医師）

1. ブラウザで http://localhost:3000/login を開く
2. ログイン情報を入力：
   - メールアドレス: `doctor@tokyo001.com`
   - パスワード: `password123`
3. 「ログイン」ボタンをクリック
4. チャット画面が表示される
5. 左サイドバーで患者「田中太郎 (P001)」を選択
6. 中央のスレッド一覧で「入院時対応」を選択
7. メッセージ入力欄に「血圧測定の結果を確認しました」と入力
8. 送信ボタンをクリック

#### PC2（看護師）

1. ブラウザで http://localhost:3000/login を開く
2. ログイン情報を入力：
   - メールアドレス: `nurse@tokyo001.com`
   - パスワード: `password123`
3. 「ログイン」ボタンをクリック
4. チャット画面が表示される
5. 左サイドバーで患者「田中太郎 (P001)」を選択
6. 中央のスレッド一覧で「入院時対応」を選択
7. **PC1 から送信されたメッセージがリアルタイムで表示されることを確認**
8. メッセージ入力欄に「了解しました。次回は 14 時に測定します」と入力
9. 送信ボタンをクリック

#### PC1 で確認

- **PC2 から送信されたメッセージがリアルタイムで表示されることを確認**

### シナリオ 2: メンション機能

#### PC1（医師）

1. メッセージ入力欄に「@佐藤花子 薬の投与時間を確認してください」と入力
2. 送信ボタンをクリック

#### PC2（看護師）

- メンションが含まれたメッセージが表示されることを確認
- メンション部分がハイライトされていることを確認

### シナリオ 3: チャンネル切り替え

#### PC1 または PC2

1. 左サイドバーで別の患者（例：「佐藤花子 (P002)」）を選択
2. スレッド一覧が切り替わることを確認
3. メッセージエリアが更新されることを確認
4. 再度「田中太郎 (P001)」を選択
5. 以前のメッセージが表示されることを確認

### シナリオ 4: スレッド切り替え

#### PC1 または PC2

1. 患者「田中太郎 (P001)」を選択
2. 中央のスレッド一覧で「薬剤管理」を選択
3. メッセージエリアが切り替わることを確認
4. 新しいメッセージを送信
5. 「入院時対応」スレッドに戻る
6. 以前のメッセージが表示されることを確認

### シナリオ 5: ファイル添付（実装済み）

#### PC1 または PC2

1. メッセージ入力欄の横にあるクリップアイコンをクリック
2. 画像ファイルを選択
3. プレビューが表示されることを確認
4. メッセージと一緒に送信
5. 相手側で画像が表示されることを確認

### シナリオ 6: 検索機能（実装済み）

#### PC1 または PC2

1. 画面上部の検索アイコンをクリック
2. 検索モーダルが開く
3. 「血圧」と入力
4. 検索結果が表示されることを確認
5. 検索結果をクリックして該当メッセージに移動

### シナリオ 7: 既読管理（実装済み）

#### PC1

1. メッセージを送信

#### PC2

1. メッセージを確認
2. メッセージをクリックして既読にする

#### PC1

1. 送信したメッセージに既読マークが表示されることを確認
2. 既読アイコンをクリックして既読者一覧を表示

## 成功基準チェックリスト

- [ ] 2 台の PC で同時ログイン可能
- [ ] リアルタイムメッセージ送受信が動作
- [ ] メッセージが 1 秒以内に相手側に表示される
- [ ] チャンネル切り替えが動作
- [ ] スレッド切り替えが動作
- [ ] メンション機能が動作
- [ ] ファイル添付が動作
- [ ] 検索機能が動作
- [ ] 既読管理が動作
- [ ] WebSocket 接続が安定している
- [ ] UI が直感的で使いやすい

## トラブルシューティング

### ログインできない

```bash
# データベースのユーザーを確認
psql postgresql://postgres:password@localhost:5432/hospital_chat -c "SELECT email, name, role FROM \"User\" WHERE email LIKE '%tokyo001%';"
```

### メッセージが送信できない

```bash
# WebSocketサーバーのログを確認
# プロセスIDは起動時に表示されます
```

### リアルタイム更新が動作しない

1. ブラウザの開発者ツールを開く（F12）
2. Console タブでエラーを確認
3. Network タブで WebSocket 接続を確認

### データをリセットしたい

```bash
# データベースをリセット
npx prisma migrate reset --force

# シードデータを再投入
npx tsx scripts/seed-multi-tenant.ts
```

## 追加機能のテスト

### 管理者機能

#### 病院管理者

1. http://localhost:3000/login にアクセス
2. `admin@tokyo001.com` / `password123` でログイン
3. http://localhost:3000/admin にアクセス
4. ユーザー管理画面が表示される
5. ユーザーの追加・編集・削除が可能

#### スーパー管理者

1. http://localhost:3000/login にアクセス
2. `super@provider.com` / `password123` でログイン
3. http://localhost:3000/super-admin にアクセス
4. 組織管理画面が表示される
5. 組織の追加・編集が可能

### ユーザー設定

1. ログイン後、右上のユーザーメニューをクリック
2. 「設定」を選択
3. http://localhost:3000/settings にアクセス
4. パスワード変更が可能

## パフォーマンス確認

### レスポンス時間

1. ブラウザの開発者ツールを開く（F12）
2. Network タブを開く
3. メッセージを送信
4. API リクエストの時間を確認（1 秒以内が目標）

### WebSocket 接続の安定性

1. 長時間（5 分以上）接続を維持
2. 定期的にメッセージを送受信
3. 接続が切れないことを確認

## デモのポイント

### 強調すべき機能

1. **リアルタイム性**: メッセージが即座に相手側に表示される
2. **使いやすさ**: Discord 風の UI で直感的に操作できる
3. **マルチテナント**: 複数の病院で利用可能
4. **セキュリティ**: 組織ごとにデータが分離されている
5. **拡張性**: 将来的な機能追加が容易

### 想定される質問と回答

**Q: スマホでも使えますか？**
A: 現在は PC 版のみですが、将来的にスマホアプリや PWA 対応を予定しています。

**Q: 電子カルテと連携できますか？**
A: 将来的に電子カルテシステムとの API 連携を予定しています。

**Q: セキュリティは大丈夫ですか？**
A: 本番環境では院内 VPN 経由でのアクセス、通信の暗号化、厳格な認証・認可を実装します。

**Q: 何人まで同時に使えますか？**
A: 現在のアーキテクチャでは数百人の同時接続に対応可能です。必要に応じてスケールアウトできます。

**Q: データのバックアップは？**
A: PostgreSQL の定期バックアップ、レプリケーション機能を利用します。

## 次のステップ

1. フィードバックの収集
2. UI/UX の改善
3. パフォーマンスの最適化
4. セキュリティの強化
5. 追加機能の実装（AI 機能、電子カルテ連携など）
